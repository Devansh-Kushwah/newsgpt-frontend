<h1 id="newsgpt">NewsGPT</h1>
<p>A powerful news aggregation and AI-powered chat application that combines news ingestion, vector embeddings, and
  intelligent responses.</p>
<h2 id="table-of-contents">Table of Contents</h2>
<ul>
  <li><a href="#features">Features</a></li>
  <li><a href="#system-architecture">System Architecture</a></li>
  <li><a href="#code-walkthrough">Code Walkthrough</a></li>
  <li><a href="#installation">Installation</a></li>
  <li><a href="#api-documentation">API Documentation</a></li>
  <li><a href="#environment-setup">Environment Setup</a></li>
  <li><a href="#running-the-application">Running the Application</a></li>
</ul>
<h2 id="features">Features</h2>
<ul>
  <li><strong>News Ingestion</strong>: Automatically fetches and processes news articles from multiple RSS sources</li>
  <li><strong>Vector Storage</strong>: Stores article embeddings for semantic search capabilities</li>
  <li><strong>AI-Powered Chat</strong>: Uses Google&#39;s Gemini AI for intelligent responses based on news context</li>
  <li><strong>Session Management</strong>: Maintains chat history and sessions using Redis</li>
  <li><strong>Real-time Streaming</strong>: Provides streaming responses for a better user experience</li>
</ul>
<h2 id="system-architecture">System Architecture</h2>
<p>The application follows a client-server architecture with:</p>
<ul>
  <li>Frontend: React-based web application</li>
  <li>Backend: Node.js/Express server</li>
  <li>Storage: Redis for sessions, Qdrant for vector storage</li>
  <li>AI: Google&#39;s Gemini for chat responses</li>
</ul>
<h2 id="code-walkthrough">Code Walkthrough</h2>
<h3 id="1-news-ingestion-pipeline">1. News Ingestion Pipeline</h3>
<h4 id="article-collection">Article Collection</h4>
<pre><code class="language-javascript">// ingest.controller.js
const articles = await fetchArticlesFromMultipleSources(50);
</code></pre>
<ul>
  <li>Fetches articles from multiple RSS sources</li>
  <li>Processes up to 50 articles at a time</li>
</ul>
<h4 id="text-processing--embedding">Text Processing &amp; Embedding</h4>
<pre><code class="language-javascript">// ingest.controller.js
const chunks = await textChunker.chunkText(article.content);
const embeddings = await Promise.all(
  chunks.map((chunk) =&gt; embeddingService.generateEmbedding(chunk))
);
</code></pre>
<ul>
  <li>Chunks article content into smaller pieces</li>
  <li>Generates embeddings for each chunk using a transformer model</li>
  <li>Stores embeddings in Qdrant vector database with metadata</li>
</ul>
<h4 id="vector-storage">Vector Storage</h4>
<pre><code class="language-javascript">// ingest.controller.js
await vectorStore.storeEmbeddings(articleId, chunks, embeddings, {
  title: article.title,
  source: article.source,
  pubDate: article.pubDate,
  link: article.link,
});
</code></pre>
<ul>
  <li>Stores embeddings with article metadata</li>
  <li>Enables semantic search capabilities</li>
</ul>
<h3 id="2-chat-system">2. Chat System</h3>
<h4 id="session-management">Session Management</h4>
<pre><code class="language-javascript">// chat.controller.js
const sessionKey = `chatSession:${sessionId}`;
const exists = await redis.exists(sessionKey);
</code></pre>
<ul>
  <li>Uses Redis for session storage</li>
  <li>Each chat session has a unique ID</li>
  <li>Stores message history with timestamps</li>
</ul>
<h4 id="context-retrieval">Context Retrieval</h4>
<pre><code class="language-javascript">// chat.controller.js
const queryEmbedding = await embeddingService.generateEmbedding(query);
const results = await vectorStore.searchSimilar(
  queryEmbedding,
  parseInt(limit) || 5
);
</code></pre>
<ul>
  <li>Generates embedding for user query</li>
  <li>Retrieves relevant article chunks using vector similarity search</li>
  <li>Limits context to top 5 most relevant chunks</li>
</ul>
<h4 id="ai-response-generation">AI Response Generation</h4>
<pre><code class="language-javascript">// chat.controller.js
const stream = await askGemini(context, query);
</code></pre>
<ul>
  <li>Uses Gemini AI to generate responses</li>
  <li>Provides relevant news context to the AI</li>
  <li>Streams responses in real-time</li>
</ul>
<h3 id="3-frontend-implementation">3. Frontend Implementation</h3>
<h4 id="session-management-1">Session Management</h4>
<pre><code class="language-typescript">// App.tsx
const [newSessionId, setNewSessionId] = useState&lt;string | null&gt;(null);
useEffect(() =&gt; {
  let storedDeviceId = localStorage.getItem(&quot;deviceId&quot;);
  if (!storedDeviceId) {
    storedDeviceId = uuidv4();
    localStorage.setItem(&quot;deviceId&quot;, storedDeviceId);
  }
  setDeviceId(storedDeviceId);
}, []);
</code></pre>
<ul>
  <li>Maintains device ID in localStorage</li>
  <li>Generates unique session IDs</li>
  <li>Manages chat history per session</li>
</ul>
<h4 id="real-time-communication">Real-time Communication</h4>
<pre><code class="language-typescript">// App.tsx
const response = await fetch(`${baseUrl}/api/chat?limit=3`, {
  method: &quot;POST&quot;,
  headers: { &quot;Content-Type&quot;: &quot;application/json&quot; },
  body: JSON.stringify({ query: text, sessionId: newSessionId }),
});

const reader = response.body?.getReader();
// ... streaming implementation
</code></pre>
<ul>
  <li>Uses Server-Sent Events (SSE) for real-time updates</li>
  <li>Handles streaming responses from the AI</li>
  <li>Updates UI in real-time as responses arrive</li>
</ul>
<h4 id="chat-history-management">Chat History Management</h4>
<pre><code class="language-typescript">// Sidebar.tsx
const fetchChatSessions = async () =&gt; {
  const response = await fetch(`${baseUrl}/api/chat/sessions`, {
    method: &quot;POST&quot;,
    body: JSON.stringify({ deviceId }),
  });
  const data = await response.json();
  setChatSessions(data);
};
</code></pre>
<ul>
  <li>Fetches and displays chat history</li>
  <li>Provides navigation between chat sessions</li>
  <li>Maintains session state</li>
</ul>
<h2 id="design-decisions--improvements">Design Decisions &amp; Improvements</h2>
<h3 id="current-design-decisions">Current Design Decisions</h3>
<ol>
  <li><strong>Vector Storage</strong></li>
</ol>
<ul>
  <li>Uses Qdrant for efficient vector similarity search</li>
  <li>Chunks articles for better context management</li>
  <li>Stores metadata with embeddings for rich search results</li>
</ul>
<ol start="2">
  <li><strong>Session Management</strong></li>
</ol>
<ul>
  <li>Redis for fast session storage</li>
  <li>Device-based session tracking</li>
  <li>Persistent chat history</li>
</ul>
<ol start="3">
  <li><strong>Real-time Updates</strong></li>
</ol>
<ul>
  <li>Server-Sent Events for streaming</li>
  <li>Progressive UI updates</li>
  <li>Error handling and recovery</li>
</ul>
<h3 id="potential-improvements">Potential Improvements</h3>
<ol>
  <li><strong>Performance</strong></li>
</ol>
<ul>
  <li>Implement caching for frequently accessed articles</li>
  <li>Add pagination for chat history</li>
  <li>Optimize embedding generation</li>
</ul>
<ol start="2">
  <li><strong>Scalability</strong></li>
</ol>
<ul>
  <li>Add database sharding for large datasets</li>
</ul>
<ol start="3">
  <li><strong>User Experience</strong></li>
</ol>
<ul>
  <li>Add typing indicators</li>
  <li>Implement message retry mechanism</li>
</ul>
<ol start="4">
  <li><strong>Security</strong></li>
</ol>
<ul>
  <li>Add authentication system</li>
</ul>
<ol start="5">
  <li><strong>Monitoring</strong></li>
</ol>
<ul>
  <li>Add logging system</li>
  <li>Add error tracking</li>
</ul>
<h2 id="installation">Installation</h2>
<ol>
  <li>Clone the repository:</li>
</ol>
<pre><code class="language-bash">git clone &lt;repository-url&gt;
cd newsgpt-backend
</code></pre>
<ol start="2">
  <li>Install dependencies:</li>
</ol>
<pre><code class="language-bash">npm install
</code></pre>
<ol start="3">
  <li>Create a <code>.env</code> file in the root directory with the following variables:</li>
</ol>
<pre><code class="language-env">REDIS_URL=your_redis_url
GOOGLE_API_KEY=your_google_api_key
QDRANT_URL=your_qdrant_url
HOST=your_host
PORT=your_port
</code></pre>
<h2 id="api-documentation">API Documentation</h2>
<h3 id="chat-endpoints">Chat Endpoints</h3>
<ol>
  <li><strong>Chat Request</strong>
    POST /api/chat
    Body: { query: string, sessionId: string }
    Query: limit=3
    Response: SSE stream</li>
  <li><strong>History Request</strong>
    POST /api/chat/history
    Body: { sessionId: string }
    Response: Message array</li>
  <li><strong>Sessions Request</strong></li>
</ol>
<h3 id="ingestion-endpoints">Ingestion Endpoints</h3>
<ol>
  <li><strong>Ingestion Request</strong>
    POST /api/ingest
    Response: Processing status</li>
</ol>
<h2 id="project-structure">Project Structure</h2>
<pre><code class="language-bash">newsgpt-backend/
  chat/
  controller/
  chat.controller.js # Chat endpoints and logic
  service/
  geminiService.js # Gemini AI integration
  chat.routes.js # Chat routes
  ingestion/
  controller/
  ingest.controller.js # Article ingestion logic
  service/
  rssFetcher.js # RSS feed fetching
  textChunker.js # Text processing
  embeddingService.js # Vector embeddings
  vectorStore.js # Vector database operations
  ingest.routes.js # Ingestion routes
  server.js # Main application entry</code></pre>
<h2 id="dependencies">Dependencies</h2>
<h3 id="backend-dependencies">Backend Dependencies</h3>
<pre><code class="language-json">{
  &quot;@google/genai&quot;: &quot;^0.13.0&quot;,
  &quot;@qdrant/js-client-rest&quot;: &quot;^1.14.0&quot;,
  &quot;@xenova/transformers&quot;: &quot;^2.15.0&quot;,
  &quot;express&quot;: &quot;^4.18.2&quot;,
  &quot;redis&quot;: &quot;^5.0.1&quot;,
  &quot;rss-parser&quot;: &quot;^3.13.0&quot;,
  &quot;cors&quot;: &quot;^2.8.5&quot;,
  &quot;dotenv&quot;: &quot;^16.5.0&quot;
}
</code></pre>
<h3 id="frontend-dependencies">Frontend Dependencies</h3>
<pre><code class="language-json">{
  &quot;react&quot;: &quot;^18.x&quot;,
  &quot;react-router-dom&quot;: &quot;^6.x&quot;,
  &quot;uuid&quot;: &quot;^11.1.0&quot;
}
</code></pre>
<h2 id="running-the-application">Running the Application</h2>
<h3 id="backend">Backend</h3>
<pre><code class="language-bash"># Development
npm run dev

# Production
npm start
</code></pre>
<h3 id="frontend">Frontend</h3>
<pre><code class="language-bash"># Development
npm start

# Production
npm run build
</code></pre>
<h2 id="error-handling">Error Handling</h2>
<p>The application includes comprehensive error handling for:</p>
<ul>
  <li>API failures</li>
  <li>Context retrieval issues</li>
  <li>Streaming errors</li>
  <li>Session management</li>
  <li>Database operations</li>
</ul>